<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Admin Dashboard - Student Payments</title>
	<link rel="stylesheet" href="main.css">
	<script src="script.js" defer></script>
</head>
<body>
	<div class="page">
		<header class="topbar">
			<h2>Admin Dashboard</h2>
			<div>
				<button id="logoutBtn" class="btn">Logout</button>
			</div>
		</header>

		<main class="container">
			<section class="card">
				<h3>All Payments</h3>
				<div id="status" class="muted"></div>
				<div class="table-wrap">
					<table id="adminTable">
						<thead>
							<tr><th>Name</th><th>Class</th><th>Amount</th><th>Mode</th><th>Date</th></tr>
						</thead>
						<tbody></tbody>
					</table>
				</div>
			</section>
		</main>
	</div>

	<script>
		(async function () {
			const storedClass = localStorage.getItem('spw_class');
			if (!storedClass) {
				window.location.href = 'login.html';
				return;
			}

			if (storedClass !== 'ALL') {
				// non-admin should go to class page
				window.location.href = 'class.html';
				return;
			}

			const status = document.getElementById('status');

			const load = async () => {
				status.textContent = 'Loading...';
				const res = await window.getStudents('ALL');
				if (!res || !res.success) {
					status.textContent = res && res.message ? res.message : 'Failed to load';
					return;
				}

				status.textContent = '';
				const tbody = document.querySelector('#adminTable tbody');
				tbody.innerHTML = '';
				(res.students || []).forEach(s => {
					const tr = document.createElement('tr');
					tr.innerHTML = `<td>${escapeHtml(s.name)}</td><td>${escapeHtml(s.class)}</td><td>${escapeHtml(s.amount)}</td><td>${escapeHtml(s.mode)}</td><td>${escapeHtml(s.date)}</td>`;
					tbody.appendChild(tr);
				});
			};

			document.getElementById('logoutBtn').addEventListener('click', () => {
				localStorage.removeItem('spw_class');
				window.location.href = 'login.html';
			});

			function escapeHtml(s) { return (s == null) ? '' : s.toString().replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }

			await load();
		})();
	</script>
</body>
</html>
